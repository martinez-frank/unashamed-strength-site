<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cart — Unashamed Strength</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000;
      --ink:#e9e6df;
      --muted:rgba(233,230,223,.78);
      --muted2:rgba(233,230,223,.62);
      --line:rgba(233,230,223,.14);

      --gold:#caa45a;
      --gold2:#b48d45;

      --shadow:0 18px 60px rgba(0,0,0,.65);
      --shadow2:0 10px 28px rgba(0,0,0,.55);

      --radius:22px;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      color:var(--ink);
      background:var(--bg);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* Force consistent link colors (prevents purple/visited look) */
    a, a:visited{ color:inherit; text-decoration:none; }

    /* Background */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:url("./assets/background_element.png") center/cover no-repeat;
      filter:blur(18px);
      transform:scale(1.06);
      opacity:.78;
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed;
      inset:0;
      background:radial-gradient(70% 85% at 50% 25%, rgba(0,0,0,.35), rgba(0,0,0,.90));
      z-index:-1;
    }

    .wrap{
      width:min(1200px, 92vw);
      margin:0 auto;
      padding:20px 0 70px;
    }

    /* =========================
       TOP NAV (Desktop + Mobile)
       ========================= */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;

      display:flex;
      align-items:center;
      justify-content:flex-end;

      padding:10px 2px 16px;
      margin-bottom:18px;

      border-bottom:1px solid rgba(233,230,223,.10);

      background:linear-gradient(180deg, rgba(0,0,0,.55), rgba(0,0,0,.18));
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .navlinks{
      display:flex;
      gap:18px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }

    .navlinks a{
      padding:10px 10px;
      border-radius:12px;
      transition:background .2s ease, color .2s ease, transform .2s ease;
      color:inherit;
    }
    .navlinks a:hover{
      background:rgba(255,255,255,.06);
      color:var(--ink);
      transform:translateY(-1px);
    }
    .navlinks a.active{
      background:rgba(255,255,255,.06);
      color:var(--ink);
    }

    .cartlink{
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .cartbadge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:22px;
      height:22px;
      padding:0 7px;
      border-radius:999px;
      border:1px solid rgba(202,164,90,.55);
      background:rgba(0,0,0,.28);
      color:rgba(233,230,223,.96);
      font-weight:800;
      font-size:12px;
      line-height:1;
    }

    /* Mobile hamburger */
    .menuBtn{
      display:none;
      align-items:center;
      justify-content:center;
      width:44px;
      height:40px;
      border-radius:12px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.20);
      cursor:pointer;
      box-shadow:0 10px 22px rgba(0,0,0,.35);
      transition:transform .18s ease, filter .18s ease, border-color .18s ease;
    }
    .menuBtn:hover{
      transform:translateY(-1px);
      filter:brightness(1.03);
      border-color:rgba(233,230,223,.20);
    }

    .hamburger{
      width:18px;
      height:12px;
      position:relative;
    }
    .hamburger span{
      position:absolute;
      left:0;
      right:0;
      height:2px;
      background:rgba(233,230,223,.86);
      border-radius:999px;
      transition:transform .2s ease, top .2s ease, opacity .2s ease;
    }
    .hamburger span:nth-child(1){ top:0; }
    .hamburger span:nth-child(2){ top:5px; }
    .hamburger span:nth-child(3){ top:10px; }

    .menuBtn[aria-expanded="true"] .hamburger span:nth-child(1){
      top:5px; transform:rotate(45deg);
    }
    .menuBtn[aria-expanded="true"] .hamburger span:nth-child(2){
      opacity:0;
    }
    .menuBtn[aria-expanded="true"] .hamburger span:nth-child(3){
      top:5px; transform:rotate(-45deg);
    }

    /* Overlay behind menu */
    .overlay{
      position:fixed;
      inset:0;
      z-index:40;
      background:rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);

      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
    }
    .overlay.open{
      opacity:1;
      pointer-events:auto;
    }

    /* Mobile dropdown panel (animated) */
    .mobilePanel{
      display:block;
      position:absolute;
      right:0;
      top:56px;
      width:min(320px, 92vw);
      border-radius:18px;
      border:1px solid rgba(233,230,223,.14);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      box-shadow:var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);

      opacity:0;
      transform:translateY(-10px) scale(.985);
      pointer-events:none;
      transition:opacity .18s ease, transform .22s cubic-bezier(.2,.9,.2,1);
      transform-origin: top right;
    }

    .mobilePanel .panelTop{
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(233,230,223,.10);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .mobilePanel .panelTop .label{
      font-family:Cinzel, serif;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:12px;
      color:rgba(233,230,223,.92);
    }

    .mobilePanel .panelLinks{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .mobilePanel a{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(233,230,223,.10);
      background:rgba(0,0,0,.18);
      color:rgba(233,230,223,.90);
      font-weight:700;
      letter-spacing:.02em;
      transition:transform .16s ease, filter .16s ease, border-color .16s ease, background .16s ease;
    }
    .mobilePanel a:hover{
      transform:translateY(-1px);
      filter:brightness(1.04);
      border-color:rgba(233,230,223,.18);
      background:rgba(255,255,255,.06);
      color:rgba(233,230,223,.96);
    }
    .mobilePanel a .right{
      display:inline-flex;
      align-items:center;
      gap:10px;
      color:rgba(233,230,223,.80);
      font-weight:800;
    }

    .mobilePanel.open{
      opacity:1;
      transform:translateY(0) scale(1);
      pointer-events:auto;
    }

    @media (prefers-reduced-motion: reduce){
      .mobilePanel, .overlay, .navlinks a, .menuBtn, .qtybtn, .itemCard{
        transition:none !important;
      }
    }

    /* =========================
       PAGE HEADER
       ========================= */
    .page-title{
      text-align:center;
      font-family:Cinzel, serif;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:44px;
      margin:18px 0 6px;
      color:rgba(233,230,223,.92);
      text-shadow:0 16px 50px rgba(0,0,0,.60);
    }
    .page-sub{
      text-align:center;
      color:rgba(233,230,223,.70);
      font-size:13px;
      letter-spacing:.02em;
      margin:0 0 22px;
    }

    .divider{
      height:1px;
      background:rgba(233,230,223,.10);
      margin:22px 0 26px;
    }

    /* =========================
       CART LAYOUT
       ========================= */
    .cartGrid{
      width:min(1020px, 92vw);
      margin:0 auto;
      display:grid;
      grid-template-columns: 1.5fr .9fr;
      gap:26px;
      align-items:start;
    }

    .panel{
      border-radius:var(--radius);
      border:1px solid rgba(233,230,223,.12);
      background:linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
      box-shadow:0 18px 60px rgba(0,0,0,.55);
      overflow:hidden;
    }

    .panelHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid rgba(233,230,223,.10);
      background:linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.20));
    }
    .panelHead .label{
      font-family:Cinzel, serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:12px;
      color:rgba(233,230,223,.92);
    }
    .panelHead .count{
      color:rgba(233,230,223,.70);
      font-size:12px;
      letter-spacing:.02em;
    }

    .items{
      padding:14px 14px 6px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .itemCard{
      border-radius:16px;
      border:1px solid rgba(233,230,223,.10);
      background:rgba(0,0,0,.18);
      box-shadow:0 10px 26px rgba(0,0,0,.35);
      padding:12px;
      display:grid;
      grid-template-columns: 64px 1fr auto;
      gap:14px;
      align-items:center;
      transition:transform .18s ease, border-color .18s ease, filter .18s ease;
    }
    .itemCard:hover{
      transform:translateY(-1px);
      border-color:rgba(233,230,223,.16);
      filter:brightness(1.02);
    }

    .thumb{
      width:64px;
      height:64px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(233,230,223,.12);
      background:rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }

    .meta .name{
      font-family:Cinzel, serif;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:14px;
      margin:0 0 6px;
      color:rgba(233,230,223,.96);
    }

    .metaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color:rgba(233,230,223,.72);
      font-size:12px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(233,230,223,.12);
      background:rgba(0,0,0,.16);
      color:rgba(233,230,223,.86);
      font-weight:700;
      letter-spacing:.02em;
    }
    .price{
      color:var(--gold);
      font-weight:900;
      letter-spacing:.02em;
    }

    .controls{
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* Quantity cluster (perfect alignment) */
    .qtyCluster{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 8px;
      border-radius:12px;
      border:1px solid rgba(233,230,223,.12);
      background:rgba(0,0,0,.18);
    }

    .qtybtn{
      width:28px;
      height:28px;
      border-radius:10px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(255,255,255,.06);
      color:rgba(233,230,223,.92);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      line-height:1;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,.35);
      transition:transform .12s ease, filter .12s ease, background .12s ease, border-color .12s ease;
      user-select:none;
    }
    .qtybtn:hover{
      transform:translateY(-1px);
      filter:brightness(1.04);
      border-color:rgba(233,230,223,.18);
    }
    .qtybtn:active{
      transform:translateY(0) scale(.96);
      filter:brightness(1.06);
    }
    .qtybtn.pulse{
      animation:pulse .18s ease;
    }
    @keyframes pulse{
      0%{ transform:scale(1); }
      50%{ transform:scale(.92); }
      100%{ transform:scale(1); }
    }

    .qtynum{
      min-width:18px;
      text-align:center;
      font-weight:900;
      color:rgba(233,230,223,.92);
      font-size:12px;
    }

    .removeBtn{
      padding:8px 12px;
      border-radius:12px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.18);
      color:rgba(233,230,223,.86);
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:11px;
      cursor:pointer;
      transition:transform .16s ease, filter .16s ease, border-color .16s ease, background .16s ease;
    }
    .removeBtn:hover{
      transform:translateY(-1px);
      filter:brightness(1.04);
      border-color:rgba(233,230,223,.18);
      background:rgba(255,255,255,.05);
      color:rgba(233,230,223,.92);
    }

    .empty{
      padding:24px 16px 18px;
      text-align:center;
      color:rgba(233,230,223,.72);
      font-size:13px;
    }
    .empty .small{
      display:block;
      margin-top:10px;
      color:rgba(233,230,223,.56);
      font-size:12px;
    }

    /* Summary */
    .summaryBody{
      padding:14px 16px 16px;
    }
    .sumRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 0;
      border-bottom:1px solid rgba(233,230,223,.10);
      color:rgba(233,230,223,.76);
      font-size:13px;
    }
    .sumRow:last-child{ border-bottom:none; }
    .sumRow strong{
      color:rgba(233,230,223,.92);
      font-weight:900;
    }
    .sumRow .value{
      color:rgba(233,230,223,.92);
      font-weight:900;
    }

    .note{
      margin-top:10px;
      color:rgba(233,230,223,.55);
      font-size:12px;
      line-height:1.35;
    }

    .actions{
      margin-top:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .btnGold{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:12px 14px;
      border-radius:12px;
      background:linear-gradient(180deg, var(--gold), var(--gold2));
      color:#0a0a0a;
      font-weight:900;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:11px;
      border:1px solid rgba(0,0,0,.35);
      box-shadow:0 14px 28px rgba(0,0,0,.55);
      transition:transform .18s ease, filter .18s ease;
      cursor:pointer;
    }
    .btnGold:hover{ transform:translateY(-1px); filter:brightness(1.04); }
    .btnGold:disabled{ opacity:.55; cursor:not-allowed; transform:none; }

    .btnGhost{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.18);
      color:rgba(233,230,223,.90);
      font-weight:900;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:11px;
      box-shadow:0 10px 22px rgba(0,0,0,.40);
      transition:transform .18s ease, filter .18s ease, border-color .18s ease, background .18s ease;
      cursor:pointer;
    }
    .btnGhost:hover{
      transform:translateY(-1px);
      filter:brightness(1.03);
      border-color:rgba(233,230,223,.18);
      background:rgba(255,255,255,.05);
    }

    /* Footer */
    .footer{
      width:min(720px, 92vw);
      margin:26px auto 0;
      text-align:center;
      padding-top:16px;
      border-top:1px solid rgba(233,230,223,.10);
    }
    .footlinks{
      display:flex;
      gap:14px;
      justify-content:center;
      font-size:12px;
      color:rgba(233,230,223,.72);
      margin-bottom:8px;
    }
    .footlinks a{
      padding:6px 10px;
      border-radius:10px;
      transition:background .2s ease, color .2s ease;
    }
    .footlinks a:hover{
      background:rgba(255,255,255,.06);
      color:rgba(233,230,223,.92);
    }
    .footnote{
      font-family:Cinzel, serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:11px;
      color:rgba(233,230,223,.55);
    }

    /* Responsive */
    @media (max-width: 980px){
      .navlinks{ display:none; }
      .menuBtn{ display:inline-flex; }

      .page-title{ font-size:38px; }
      .cartGrid{
        grid-template-columns: 1fr;
        gap:16px;
      }
      .itemCard{
        grid-template-columns: 56px 1fr;
        grid-template-areas:
          "thumb meta"
          "thumb controls";
        align-items:start;
      }
      .thumb{ grid-area:thumb; width:56px; height:56px; }
      .meta{ grid-area:meta; }
      .controls{ grid-area:controls; justify-content:flex-start; margin-top:8px; }
      .wrap{ padding-top:14px; }
    }
  </style>
</head>

<body>
  <!-- overlay (mobile menu backdrop) -->
  <div class="overlay" id="overlay" aria-hidden="true"></div>

  <div class="wrap">

    <!-- TOP NAV (Home / Shop / About / Cart only — NO contact) -->
    <header class="topbar">
      <nav class="navlinks" aria-label="Primary navigation">
        <a href="./index.html">Home</a>
        <a href="./shop.html">Shop</a>
        <a href="./about.html">About</a>
        <a class="cartlink active" href="./cart.html" aria-label="View cart">
          Cart <span class="cartbadge" id="cartCount">0</span>
        </a>
      </nav>

      <button class="menuBtn" id="menuBtn" type="button" aria-label="Open menu" aria-expanded="false" aria-controls="mobilePanel">
        <div class="hamburger" aria-hidden="true">
          <span></span><span></span><span></span>
        </div>
      </button>

      <div class="mobilePanel" id="mobilePanel" role="dialog" aria-modal="false" aria-label="Mobile menu">
        <div class="panelTop">
          <div class="label">Menu</div>
          <div class="cartlink" aria-label="Cart count">
            <span style="color:rgba(233,230,223,.75); font-size:12px;">Cart</span>
            <span class="cartbadge" id="cartCountMobile">0</span>
          </div>
        </div>

        <div class="panelLinks">
          <a href="./index.html"><span>Home</span><span class="right">›</span></a>
          <a href="./shop.html"><span>Shop</span><span class="right">›</span></a>
          <a href="./about.html"><span>About</span><span class="right">›</span></a>
          <a href="./cart.html">
            <span>Cart</span>
            <span class="right"><span class="cartbadge" id="cartCountMobileLink">0</span></span>
          </a>
        </div>
      </div>
    </header>

    <h1 class="page-title">Cart</h1>
    <p class="page-sub">Review your items below. Update sizes and quantities before checkout.</p>

    <div class="cartGrid">

      <!-- LEFT: ITEMS -->
      <section class="panel">
        <div class="panelHead">
          <div class="label">Your Items</div>
          <div class="count"><span id="itemCountLabel">0</span> item(s)</div>
        </div>

        <div class="items" id="itemsWrap">
          <!-- JS renders item cards here -->
        </div>

        <div class="empty" id="emptyState" style="display:none;">
          Your cart is empty.
          <span class="small">Head to the shop to add your first item.</span>
        </div>
      </section>

      <!-- RIGHT: SUMMARY -->
      <aside class="panel">
        <div class="panelHead">
          <div class="label">Summary</div>
          <div class="count">Taxes/shipping later</div>
        </div>

        <div class="summaryBody">
          <div class="sumRow">
            <span>Subtotal</span>
            <span class="value" id="subtotal">$0.00</span>
          </div>
          <div class="sumRow">
            <span>Estimated Shipping</span>
            <span class="value">—</span>
          </div>
          <div class="sumRow">
            <strong>Total</strong>
            <strong class="value" id="total">$0.00</strong>
          </div>

          <div class="note" id="orderMetaNote" style="display:none;">
            <div><strong>Order ID:</strong> <span id="orderIdTxt"></span></div>
            <div><strong>Timestamp:</strong> <span id="orderTimeTxt"></span></div>
          </div>

          <div class="actions">
            <button class="btnGold" id="emailOrderBtn" type="button">Email Order</button>
            <button class="btnGhost" id="clearCartBtn" type="button">Clear Cart</button>
          </div>

          <div class="note" style="margin-top:12px;">
            You’ll submit your order by email for now. We’ll confirm shipping + tax after review.
          </div>
        </div>
      </aside>

    </div>

    <div class="divider"></div>

    <div class="footer">
      <div class="footlinks">
        <a href="./shop.html">Shop</a>
        <a href="./about.html">About</a>
      </div>
      <div class="footnote">Faith • Discipline • Purpose</div>
    </div>

  </div>

  <script>
    // ============
    // CONFIG
    // ============
    const CART_KEY = "us_cart_v1";

    // Set your receiving email (brand/team email).
    // If you want it to go to Donnie for now, put his email here.
    const ORDER_TO_EMAIL = "maresdonny5@gmail.com";

    // ============
    // CART HELPERS
    // ============
    function getCart(){
      try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
      catch { return []; }
    }

    function saveCart(cart){
      localStorage.setItem(CART_KEY, JSON.stringify(cart || []));
      updateAllBadges();
    }

    function countCart(cart){
      return (cart || []).reduce((a,x)=>a + (Number(x.qty || 1)), 0);
    }

    function money(n){
      const v = Number(n || 0);
      return v.toLocaleString(undefined, { style:"currency", currency:"USD" });
    }

    function safeUpper(s){
      return String(s || "").trim();
    }

    // fallback image mapping (if item.image isn't stored)
    function fallbackImageForName(name){
      const n = String(name || "").toLowerCase();
      if (n.includes("driven")) return "./assets/driven_by_faith_tee.png";
      if (n.includes("built by faith") && n.includes("hoodie")) return "./assets/built_by_faith_black_hoodie.png";
      if (n.includes("built by faith") && n.includes("tee")) return "./assets/built_by_faith_tee.png";
      if (n.includes("built to endure")) return "./assets/built_to_endure_tee.png";
      if (n.includes("faith over fear")) return "./assets/faith_over_fear_tee.png";
      if (n.includes("faith") && n.includes("purpose")) return "./assets/faith_strength_purpose_tee.png";
      if (n.includes("shaker")) return "./assets/shaker_bottle.png";
      return "./assets/logo.homepage.png";
    }

    function normalizeCart(cart){
      // Ensure each line item has: id, name, price, qty, size, image
      return (cart || []).map((it, idx) => {
        const qty = Math.max(1, Number(it.qty || 1));
        const price = Number(it.price || 0);
        const name = String(it.name || it.title || "Item");
        const size = (it.size === undefined || it.size === null) ? "—" : String(it.size);
        const image = it.image ? String(it.image) : fallbackImageForName(name);
        const id = it.id ? String(it.id) : `${name.replace(/\s+/g,"_").toLowerCase()}__${size}__${idx}`;
        return { ...it, id, name, price, qty, size, image };
      });
    }

    function calcSubtotal(cart){
      return (cart || []).reduce((sum, it) => sum + (Number(it.price||0) * Number(it.qty||1)), 0);
    }

    // ============
    // ORDER ID + TIMESTAMP
    // ============
    function pad2(n){ return String(n).padStart(2,"0"); }
    function makeOrderId(){
      // Example: US-20251230-121045-8B50
      const d = new Date();
      const y = d.getFullYear();
      const mo = pad2(d.getMonth()+1);
      const da = pad2(d.getDate());
      const hh = pad2(d.getHours());
      const mm = pad2(d.getMinutes());
      const ss = pad2(d.getSeconds());
      const rand = Math.random().toString(16).slice(2,6).toUpperCase();
      return `US-${y}${mo}${da}-${hh}${mm}${ss}-${rand}`;
    }
    function isoLocal(d){
      const y = d.getFullYear();
      const mo = pad2(d.getMonth()+1);
      const da = pad2(d.getDate());
      const hh = pad2(d.getHours());
      const mm = pad2(d.getMinutes());
      const ss = pad2(d.getSeconds());
      return `${y}-${mo}-${da} ${hh}:${mm}:${ss}`;
    }

    // ============
    // RENDER
    // ============
    function updateAllBadges(){
      const cart = normalizeCart(getCart());
      const count = String(countCart(cart));

      const a = document.getElementById("cartCount");
      const b = document.getElementById("cartCountMobile");
      const c = document.getElementById("cartCountMobileLink");

      if (a) a.textContent = count;
      if (b) b.textContent = count;
      if (c) c.textContent = count;

      // keep storage synced (so other tabs update)
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }

    function render(){
      const itemsWrap = document.getElementById("itemsWrap");
      const emptyState = document.getElementById("emptyState");
      const itemCountLabel = document.getElementById("itemCountLabel");

      let cart = normalizeCart(getCart());

      // If we normalized, persist it (keeps thumbnails stable)
      localStorage.setItem(CART_KEY, JSON.stringify(cart));

      const totalCount = countCart(cart);
      const uniqueCount = cart.length;

      itemCountLabel.textContent = String(uniqueCount);

      // Totals
      const sub = calcSubtotal(cart);
      document.getElementById("subtotal").textContent = money(sub);
      document.getElementById("total").textContent = money(sub);

      // Empty state
      if (uniqueCount === 0){
        itemsWrap.innerHTML = "";
        emptyState.style.display = "block";
        document.getElementById("emailOrderBtn").disabled = true;
        document.getElementById("clearCartBtn").disabled = true;

        document.getElementById("orderMetaNote").style.display = "none";
        return;
      }

      emptyState.style.display = "none";
      document.getElementById("emailOrderBtn").disabled = false;
      document.getElementById("clearCartBtn").disabled = false;

      itemsWrap.innerHTML = cart.map(it => `
        <div class="itemCard" data-id="${it.id}">
          <div class="thumb">
            <img src="${it.image}" alt="${escapeHtml(it.name)} thumbnail" loading="lazy">
          </div>

          <div class="meta">
            <div class="name">${escapeHtml(it.name)}</div>
            <div class="metaRow">
              <span class="pill">Size <strong>${escapeHtml(it.size)}</strong></span>
              <span class="pill price">${money(it.price)}</span>
            </div>
          </div>

          <div class="controls">
            <div class="qtyCluster" aria-label="Quantity controls">
              <button class="qtybtn" data-action="dec" type="button" aria-label="Decrease quantity">−</button>
              <div class="qtynum" aria-label="Quantity">${it.qty}</div>
              <button class="qtybtn" data-action="inc" type="button" aria-label="Increase quantity">+</button>
            </div>
            <button class="removeBtn" data-action="remove" type="button">Remove</button>
          </div>
        </div>
      `).join("");

      updateAllBadges();
    }

    function escapeHtml(s){
      return String(s || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ============
    // INTERACTIONS (qty +/- aligned + animated)
    // ============
    function pulse(btn){
      btn.classList.remove("pulse");
      void btn.offsetWidth; // reflow
      btn.classList.add("pulse");
    }

    function updateQty(id, delta){
      let cart = normalizeCart(getCart());
      const idx = cart.findIndex(x => x.id === id);
      if (idx === -1) return;

      const next = Math.max(1, Number(cart[idx].qty || 1) + delta);
      cart[idx].qty = next;

      saveCart(cart);
      render();
    }

    function removeItem(id){
      let cart = normalizeCart(getCart());
      cart = cart.filter(x => x.id !== id);
      saveCart(cart);
      render();
    }

    document.addEventListener("click", (e) => {
      const card = e.target.closest(".itemCard");
      if (!card) return;

      const id = card.getAttribute("data-id");
      const btn = e.target.closest("button");
      if (!btn) return;

      const action = btn.getAttribute("data-action");
      if (!action) return;

      if (action === "inc"){
        pulse(btn);
        updateQty(id, +1);
      } else if (action === "dec"){
        pulse(btn);
        updateQty(id, -1);
      } else if (action === "remove"){
        removeItem(id);
      }
    });

    // ============
    // EMAIL ORDER (Order ID + timestamp + formatted)
    // ============
    function buildEmailBody(orderId, ts, cart){
      const lines = [];
      lines.push("Hello Unashamed Strength Team,");
      lines.push("");
      lines.push("NEW ORDER REQUEST");
      lines.push(`Order ID: ${orderId}`);
      lines.push(`Timestamp: ${ts}`);
      lines.push("");
      lines.push("ITEMS");

      cart.forEach(it => {
        lines.push(`• ${it.name} | Size: ${it.size} | Qty: ${it.qty} | Unit: ${money(it.price)}`);
      });

      lines.push("");
      lines.push("TOTALS");
      const sub = calcSubtotal(cart);
      lines.push(`Subtotal: ${money(sub)}`);
      lines.push("Shipping: TBD");
      lines.push("Tax: TBD");
      lines.push(`Total: ${money(sub)}`);
      lines.push("");
      lines.push("CUSTOMER INFO (fill in)");
      lines.push("Name:");
      lines.push("Phone:");
      lines.push("Email:");
      lines.push("Shipping Address:");
      lines.push("City/State/Zip:");
      lines.push("");
      lines.push("Notes:");
      return lines.join("\n");
    }

    function emailOrder(){
      const cart = normalizeCart(getCart());
      if (!cart.length) return;

      const orderId = makeOrderId();
      const ts = isoLocal(new Date());

      // show meta note on UI
      document.getElementById("orderMetaNote").style.display = "block";
      document.getElementById("orderIdTxt").textContent = orderId;
      document.getElementById("orderTimeTxt").textContent = ts;

      const subject = `[US ORDER] ${orderId} — ${cart.length} item(s)`;
      const body = buildEmailBody(orderId, ts, cart);

      const mailto = `mailto:${encodeURIComponent(ORDER_TO_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      window.location.href = mailto;
    }

    document.getElementById("emailOrderBtn").addEventListener("click", emailOrder);

    // ============
    // CLEAR CART
    // ============
    document.getElementById("clearCartBtn").addEventListener("click", () => {
      localStorage.setItem(CART_KEY, JSON.stringify([]));
      updateAllBadges();
      render();
    });

    // ============
    // MOBILE MENU (same as homepage)
    // ============
    const menuBtn = document.getElementById("menuBtn");
    const mobilePanel = document.getElementById("mobilePanel");
    const overlay = document.getElementById("overlay");

    function closeMenu(){
      mobilePanel.classList.remove("open");
      overlay.classList.remove("open");
      menuBtn.setAttribute("aria-expanded", "false");
    }
    function openMenu(){
      mobilePanel.classList.add("open");
      overlay.classList.add("open");
      menuBtn.setAttribute("aria-expanded", "true");
    }
    function toggleMenu(){
      const isOpen = mobilePanel.classList.contains("open");
      if (isOpen) closeMenu(); else openMenu();
    }

    menuBtn.addEventListener("click", toggleMenu);
    overlay.addEventListener("click", closeMenu);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeMenu();
    });

    mobilePanel.addEventListener("click", (e) => {
      const link = e.target.closest("a");
      if (link) closeMenu();
    });

    // Sync cart count if multiple tabs update it
    window.addEventListener("storage", (e) => {
      if (e.key === CART_KEY) {
        updateAllBadges();
        render();
      }
    });

    // ============
    // INIT
    // ============
    updateAllBadges();
    render();
  </script>
</body>
</html>
