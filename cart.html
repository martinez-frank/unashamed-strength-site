<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cart — Unashamed Strength</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#000;
      --ink:#e9e6df;
      --muted:rgba(233,230,223,.80);
      --muted2:rgba(233,230,223,.62);

      --gold:#caa45a;
      --gold2:#b48d45;

      --radius:20px;
      --shadow: 0 18px 60px rgba(0,0,0,.62);
      --shadow2: 0 10px 30px rgba(0,0,0,.55);
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      color:var(--ink);
      background:var(--bg);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow-x:hidden;
    }

    /* ✅ Fix nav link colors (gold + on-hover white) */
    a{color:var(--muted); text-decoration:none;}
    a:hover{color:var(--ink);}

    body::before{
      content:"";
      position:fixed;
      inset:0;
      background:url("./assets/background_element.png") center/cover no-repeat;
      filter:blur(18px);
      transform:scale(1.06);
      opacity:.78;
      z-index:-2;
    }
    body::after{
      content:"";
      position:fixed;
      inset:0;
      background: radial-gradient(70% 85% at 50% 22%, rgba(0,0,0,.28), rgba(0,0,0,.90));
      z-index:-1;
    }

    .wrap{
      width:min(1100px, 92vw);
      margin:0 auto;
      padding:18px 0 90px; /* extra bottom space for mobile bar */
    }

    .topbar{
      display:flex;
      justify-content:flex-end;
      align-items:center;
      padding:14px 6px 16px;
      border-bottom:1px solid rgba(233,230,223,.10);
      margin-bottom:24px;
    }
    .navlinks{
      display:flex;
      gap:18px;
      align-items:center;
      font-size:13px;
      color:var(--muted);
    }
    .navlinks a{
      padding:10px 10px;
      border-radius:12px;
      transition:background .2s ease, color .2s ease, transform .2s ease;
      color:var(--muted);
    }
    .navlinks a:hover{
      background:rgba(255,255,255,.06);
      color:var(--ink);
      transform:translateY(-1px);
    }
    .navlinks a.active{
      background:rgba(255,255,255,.06);
      color:var(--ink);
    }

    .cartlink{
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .cartbadge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:22px;
      height:22px;
      padding:0 7px;
      border-radius:999px;
      border:1px solid rgba(202,164,90,.55);
      background:rgba(0,0,0,.28);
      color:rgba(233,230,223,.96);
      font-weight:800;
      font-size:12px;
      line-height:1;
    }

    .page-title{
      text-align:center;
      margin:10px 0 10px;
      font-family:Cinzel, serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:56px;
      line-height:1.03;
      opacity:.98;
      text-shadow:0 10px 40px rgba(0,0,0,.55);
    }

    .sub{
      text-align:center;
      margin:0 auto 26px;
      color:var(--muted);
      font-size:18px;
      max-width:860px;
      line-height:1.55;
      text-shadow:0 10px 35px rgba(0,0,0,.55);
    }

    .layout{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:22px;
      align-items:start;
    }

    .panel{
      border-radius:var(--radius);
      border:1px solid rgba(233,230,223,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    .panel-head{
      padding:16px 18px;
      border-bottom:1px solid rgba(233,230,223,.10);
      background:linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.26));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .panel-head .h{
      font-family:Cinzel, serif;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:13px;
      opacity:.95;
    }
    .panel-head .meta{
      color:var(--muted2);
      font-size:12px;
      letter-spacing:.02em;
      white-space:nowrap;
    }

    .items{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .item{
      border:1px solid rgba(233,230,223,.12);
      background:rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px 12px;
      display:grid;
      grid-template-columns: 72px 1fr auto;
      gap:12px;
      align-items:center;
    }

    /* ✅ Thumbnails */
    .thumb{
      width:72px;
      height:72px;
      border-radius:14px;
      overflow:hidden;
      border:1px solid rgba(233,230,223,.16);
      background:rgba(0,0,0,.25);
      box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform:scale(1.02);
    }

    .item-left{
      min-width:0;
    }
    .item-name{
      font-family:Cinzel, serif;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:13px;
      margin:0 0 6px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .item-sub{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      color:var(--muted2);
      font-size:12px;
    }
    .pill{
      border:1px solid rgba(202,164,90,.45);
      background:rgba(202,164,90,.10);
      color:rgba(233,230,223,.95);
      padding:6px 10px;
      border-radius:999px;
      font-weight:700;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:11px;
    }
    .price{
      color:var(--gold);
      font-weight:900;
      letter-spacing:.02em;
    }

    .item-right{
      display:flex;
      align-items:center;
      gap:10px;
    }

    /* ✅ Aligned quantity controls (centered + consistent) */
    .qty{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.22);
      padding:8px 10px;
      border-radius:14px;
      height:44px; /* locks alignment */
    }
    .qbtn{
      width:30px;
      height:30px;
      border-radius:10px;
      border:1px solid rgba(202,164,90,.45);
      background:rgba(0,0,0,.22);
      color:rgba(233,230,223,.95);
      cursor:pointer;
      font-weight:900;
      line-height:1;
      display:flex;            /* ✅ centers symbol */
      align-items:center;
      justify-content:center;
      transition:transform .16s ease, filter .16s ease, border-color .16s ease, background .16s ease;
      user-select:none;
    }
    .qbtn:hover{
      transform:translateY(-1px);
      border-color:rgba(202,164,90,.85);
      filter:brightness(1.03);
      background:rgba(255,255,255,.04);
    }
    .qbtn:active{
      transform:translateY(0px) scale(.96);
    }

    .qnum{
      min-width:20px;
      text-align:center;
      font-weight:900;
      color:rgba(233,230,223,.95);
      position:relative;
      top:0;
    }

    /* ✅ Animation: button + number pop */
    @keyframes pop {
      0%   { transform:scale(1); filter:brightness(1); }
      40%  { transform:scale(1.12); filter:brightness(1.08); }
      100% { transform:scale(1); filter:brightness(1); }
    }
    .pop{ animation: pop 180ms ease-out; }

    .remove{
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.18);
      color:rgba(233,230,223,.9);
      border-radius:12px;
      padding:9px 10px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:10px;
      transition:transform .14s ease, filter .14s ease, border-color .14s ease, background .14s ease;
      height:44px; /* ✅ matches qty height */
    }
    .remove:hover{
      transform:translateY(-1px);
      filter:brightness(1.05);
      border-color:rgba(233,230,223,.22);
      background:rgba(255,255,255,.06);
    }

    .summary{
      padding:14px 14px 16px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      color:var(--muted);
      font-size:13px;
    }
    .row strong{
      color:var(--ink);
      font-weight:900;
    }
    .row.total{
      padding-top:10px;
      border-top:1px solid rgba(233,230,223,.10);
      color:var(--ink);
      font-size:14px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:100%;
      background:linear-gradient(180deg, var(--gold), var(--gold2));
      color:#0a0a0a;
      font-weight:900;
      letter-spacing:.10em;
      text-transform:uppercase;
      font-size:12px;
      padding:12px 18px;
      border-radius:14px;
      border:1px solid rgba(0,0,0,.35);
      box-shadow:0 14px 28px rgba(0,0,0,.55);
      transition:transform .2s ease, filter .2s ease, opacity .2s ease;
      cursor:pointer;
    }
    .btn:hover{transform:translateY(-1px); filter:brightness(1.03);}

    .btn.secondary{
      background:rgba(0,0,0,.18);
      color:rgba(233,230,223,.95);
      border:1px solid rgba(233,230,223,.14);
      box-shadow:none;
    }

    .empty{
      padding:26px 18px 22px;
      text-align:center;
      color:var(--muted);
    }
    .empty .big{
      font-family:Cinzel, serif;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:13px;
      margin-bottom:8px;
      color:rgba(233,230,223,.92);
    }
    .empty .small{
      color:var(--muted2);
      font-size:13px;
      line-height:1.55;
      margin-bottom:14px;
    }
    .empty a{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:11px 14px;
      border-radius:14px;
      border:1px solid rgba(202,164,90,.45);
      background:rgba(202,164,90,.14);
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:11px;
      color:rgba(233,230,223,.92);
    }
    .empty a:hover{color:#fff; filter:brightness(1.05);}

    .note{
      margin:28px auto 0;
      text-align:center;
      color:var(--muted2);
      font-family:Cinzel, serif;
      letter-spacing:.14em;
      text-transform:uppercase;
      font-size:12px;
      padding-top:18px;
      border-top:1px solid rgba(233,230,223,.10);
      width:min(920px, 92vw);
    }

    /* ✅ MOBILE CART DRAWER (summary becomes bottom bar + slide-up drawer) */
    .mobile-bar{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px;
      background:linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,.88));
      border-top:1px solid rgba(233,230,223,.12);
      backdrop-filter: blur(10px);
      z-index:50;
      display:none;
    }
    .mobile-bar-inner{
      width:min(1100px, 92vw);
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .mobile-total{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .mobile-total .label{
      color:var(--muted2);
      font-size:11px;
      letter-spacing:.08em;
      text-transform:uppercase;
    }
    .mobile-total .value{
      font-weight:900;
      color:var(--ink);
    }
    .mobile-actions{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .miniBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.22);
      color:rgba(233,230,223,.95);
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:11px;
      cursor:pointer;
    }
    .miniBtn.primary{
      background:linear-gradient(180deg, var(--gold), var(--gold2));
      color:#0a0a0a;
      border:1px solid rgba(0,0,0,.35);
    }

    .drawer-overlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.55);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease;
      z-index:60;
    }
    .drawer{
      position:fixed;
      left:0; right:0; bottom:0;
      transform:translateY(110%);
      transition:transform .22s ease;
      z-index:61;
      padding:0 12px 14px;
    }
    .drawer-card{
      width:min(1100px, 92vw);
      margin:0 auto;
      border-radius:18px;
      border:1px solid rgba(233,230,223,.14);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.30));
      box-shadow:0 22px 70px rgba(0,0,0,.70);
      overflow:hidden;
    }
    .drawer-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 14px;
      border-bottom:1px solid rgba(233,230,223,.10);
    }
    .drawer-head .t{
      font-family:Cinzel, serif;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-size:13px;
    }
    .drawer-close{
      width:38px;
      height:38px;
      border-radius:12px;
      border:1px solid rgba(233,230,223,.14);
      background:rgba(0,0,0,.22);
      color:rgba(233,230,223,.95);
      cursor:pointer;
      font-weight:900;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .drawer-body{ padding:14px; }

    .drawer-open .drawer-overlay{
      opacity:1;
      pointer-events:auto;
    }
    .drawer-open .drawer{
      transform:translateY(0%);
    }

    @media (max-width:980px){
      .layout{grid-template-columns:1fr;}
      .page-title{font-size:48px;}
    }
    @media (max-width:720px){
      /* hide the side summary panel on mobile; use drawer instead */
      .layout{gap:14px;}
      #summaryPanel{display:none;}
      .mobile-bar{display:block;}
      .wrap{padding-bottom:120px;}
    }
    @media (max-width:520px){
      .page-title{font-size:42px;}
      .item{
        grid-template-columns:64px 1fr;
        grid-auto-rows:auto;
        align-items:start;
      }
      .thumb{width:64px;height:64px;border-radius:12px;}
      .item-right{
        grid-column: 1 / -1;
        justify-content:space-between;
        margin-top:8px;
      }
      .panel-head{flex-direction:column; align-items:flex-start;}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="navlinks">
        <a href="./index.html">Home</a>
        <a href="./shop.html">Shop</a>
        <a href="./about.html">About</a>
        <a href="./index.html#contact">Contact</a>

        <a class="cartlink active" href="./cart.html" aria-label="View cart">
          Cart <span class="cartbadge" id="cartCount">0</span>
        </a>
      </div>
    </div>

    <div class="page-title">Cart</div>
    <div class="sub">Review your items below. Update sizes and quantities before checkout.</div>

    <div class="layout">
      <!-- Items -->
      <div class="panel" id="itemsPanel">
        <div class="panel-head">
          <div class="h">Your Items</div>
          <div class="meta" id="itemsMeta">0 items</div>
        </div>

        <div class="items" id="items"></div>

        <div class="empty" id="emptyState" style="display:none;">
          <div class="big">Your cart is empty</div>
          <div class="small">Head back to the shop and add your gear. Sizes and quantities will save automatically.</div>
          <a href="./shop.html">Back to Shop</a>
        </div>
      </div>

      <!-- Summary (desktop/tablet) -->
      <div class="panel" id="summaryPanel">
        <div class="panel-head">
          <div class="h">Summary</div>
          <div class="meta">Taxes/shipping later</div>
        </div>
        <div class="summary">
          <div class="row">
            <span>Subtotal</span>
            <strong id="subtotal">$0.00</strong>
          </div>
          <div class="row">
            <span>Estimated Shipping</span>
            <span class="muted">—</span>
          </div>
          <div class="row total">
            <span>Total</span>
            <strong id="total">$0.00</strong>
          </div>

          <button class="btn" id="checkoutBtn" type="button">Email Order</button>
          <button class="btn secondary" id="clearBtn" type="button">Clear Cart</button>
        </div>
      </div>
    </div>

    <div class="note">Faith • Discipline • Purpose</div>
  </div>

  <!-- ✅ Mobile bottom bar -->
  <div class="mobile-bar" id="mobileBar" aria-hidden="true">
    <div class="mobile-bar-inner">
      <div class="mobile-total">
        <div class="label">Total</div>
        <div class="value" id="mobileTotal">$0.00</div>
      </div>
      <div class="mobile-actions">
        <button class="miniBtn" id="openDrawerBtn" type="button">Summary</button>
        <button class="miniBtn primary" id="mobileCheckoutBtn" type="button">Email</button>
      </div>
    </div>
  </div>

  <!-- ✅ Drawer -->
  <div class="drawer-overlay" id="drawerOverlay"></div>
  <div class="drawer" id="drawer">
    <div class="drawer-card" role="dialog" aria-modal="true" aria-label="Cart summary">
      <div class="drawer-head">
        <div class="t">Summary</div>
        <button class="drawer-close" id="drawerCloseBtn" type="button" aria-label="Close">✕</button>
      </div>
      <div class="drawer-body">
        <div class="row">
          <span>Subtotal</span>
          <strong id="drawerSubtotal">$0.00</strong>
        </div>
        <div class="row">
          <span>Estimated Shipping</span>
          <span class="muted">—</span>
        </div>
        <div class="row total">
          <span>Total</span>
          <strong id="drawerTotal">$0.00</strong>
        </div>

        <button class="btn" id="drawerCheckoutBtn" type="button">Email Order</button>
        <button class="btn secondary" id="drawerClearBtn" type="button">Clear Cart</button>
      </div>
    </div>
  </div>

  <script>
    /**************************************************************
     * CONFIG
     **************************************************************/
    const CART_KEY = "us_cart_v1";

    // ✅ Build-phase admin email
    const ORDER_EMAIL = "maresdonny5@gmail.com";

    // ✅ Stripe Phase 1 (Payment Link) - set this when ready:
    // Example: const STRIPE_PAYMENT_LINK = "https://buy.stripe.com/xxxxxx";
    const STRIPE_PAYMENT_LINK = "";

    // ✅ Subject prefix so emails sort nicely
    const SUBJECT_PREFIX = "[US ORDER] ";

    // ✅ Product -> image path map (must match shop product names)
    const IMAGE_MAP = {
      "Driven By Faith Tee": "./assets/driven_by_faith_tee.png",
      "Built By Faith Tee": "./assets/built_by_faith_tee.png",
      "Built To Endure Tee": "./assets/built_to_endure_tee.png",
      "Faith Over Fear Tee": "./assets/faith_over_fear_tee.png",
      "Faith • Strength • Purpose Tee": "./assets/faith_strength_purpose_tee.png",
      "Faith Strength Purpose Tee": "./assets/faith_strength_purpose_tee.png",
      "Logo Front/Back Tee": "./assets/logo_front_back_tee.png",
      "Unashamed Shaker Bottle": "./assets/shaker_bottle.png",
      "Built By Faith Hoodie": "./assets/built_by_faith_black_hoodie.png",
      "Unashamed Hoodie": "./assets/unashamed_black_white_hoodie.png",
      "Unashamed Unbroken Hoodie": "./assets/unashamed_unbroken_black_hoodie.png"
    };

    function getCart(){
      try { return JSON.parse(localStorage.getItem(CART_KEY)) || []; }
      catch { return []; }
    }
    function setCart(cart){
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
    }
    function countCart(cart){
      return (cart || []).reduce((a,x)=>a + (x.qty || 1), 0);
    }
    function money(n){
      return "$" + (Number(n || 0)).toFixed(2);
    }
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function calcSubtotal(cart){
      return (cart || []).reduce((sum, item) => {
        const price = Number(item.price || 0);
        const qty = Number(item.qty || 1);
        return sum + (price * qty);
      }, 0);
    }

    // ✅ Order ID + timestamp
    function pad2(n){ return String(n).padStart(2,"0"); }
    function makeOrderId(){
      const d = new Date();
      const stamp =
        d.getFullYear() +
        pad2(d.getMonth()+1) +
        pad2(d.getDate()) + "-" +
        pad2(d.getHours()) +
        pad2(d.getMinutes()) +
        pad2(d.getSeconds());
      const rand = Math.random().toString(16).slice(2,6).toUpperCase();
      return `US-${stamp}-${rand}`;
    }
    function localTimestamp(){
      const d = new Date();
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())} ${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
    }

    // DOM
    const cartCountEl = document.getElementById("cartCount");
    const itemsEl = document.getElementById("items");
    const itemsMeta = document.getElementById("itemsMeta");
    const emptyState = document.getElementById("emptyState");

    const subtotalEl = document.getElementById("subtotal");
    const totalEl = document.getElementById("total");

    // Mobile
    const mobileTotalEl = document.getElementById("mobileTotal");
    const drawerSubtotalEl = document.getElementById("drawerSubtotal");
    const drawerTotalEl = document.getElementById("drawerTotal");

    const clearBtn = document.getElementById("clearBtn");
    const checkoutBtn = document.getElementById("checkoutBtn");

    const drawerClearBtn = document.getElementById("drawerClearBtn");
    const drawerCheckoutBtn = document.getElementById("drawerCheckoutBtn");

    const mobileCheckoutBtn = document.getElementById("mobileCheckoutBtn");

    const openDrawerBtn = document.getElementById("openDrawerBtn");
    const drawerOverlay = document.getElementById("drawerOverlay");
    const drawerCloseBtn = document.getElementById("drawerCloseBtn");

    function updateBadge(){
      const cart = getCart();
      if (cartCountEl) cartCountEl.textContent = String(countCart(cart));
    }

    function render(){
      const cart = getCart();
      updateBadge();

      const itemCount = countCart(cart);
      if (itemsMeta) itemsMeta.textContent = `${itemCount} item${itemCount === 1 ? "" : "s"}`;

      // empty vs filled
      if (!cart.length){
        if (itemsEl) itemsEl.innerHTML = "";
        if (emptyState) emptyState.style.display = "block";
        const z = money(0);
        if (subtotalEl) subtotalEl.textContent = z;
        if (totalEl) totalEl.textContent = z;
        if (mobileTotalEl) mobileTotalEl.textContent = z;
        if (drawerSubtotalEl) drawerSubtotalEl.textContent = z;
        if (drawerTotalEl) drawerTotalEl.textContent = z;
        return;
      } else {
        if (emptyState) emptyState.style.display = "none";
      }

      // items
      itemsEl.innerHTML = cart.map((item, idx) => {
        const name = item.product || "Item";
        const size = item.size || "—";
        const price = Number(item.price || 0);
        const qty = Number(item.qty || 1);
        const img = IMAGE_MAP[name] || "./assets/logo_front_back_tee.png";

        return `
          <div class="item" data-index="${idx}">
            <div class="thumb" aria-hidden="true">
              <img src="${img}" alt="${escapeHtml(name)} thumbnail">
            </div>

            <div class="item-left">
              <div class="item-name" title="${escapeHtml(name)}">${escapeHtml(name)}</div>
              <div class="item-sub">
                <span class="pill">Size ${escapeHtml(size)}</span>
                <span class="price">${money(price)}</span>
              </div>
            </div>

            <div class="item-right">
              <div class="qty" aria-label="Quantity controls">
                <button class="qbtn" data-action="dec" type="button" aria-label="Decrease quantity">−</button>
                <div class="qnum" aria-label="Quantity">${qty}</div>
                <button class="qbtn" data-action="inc" type="button" aria-label="Increase quantity">+</button>
              </div>
              <button class="remove" data-action="remove" type="button">Remove</button>
            </div>
          </div>
        `;
      }).join("");

      // totals
      const sub = calcSubtotal(cart);
      const t = money(sub);
      if (subtotalEl) subtotalEl.textContent = t;
      if (totalEl) totalEl.textContent = t;

      // mobile mirror
      if (mobileTotalEl) mobileTotalEl.textContent = t;
      if (drawerSubtotalEl) drawerSubtotalEl.textContent = t;
      if (drawerTotalEl) drawerTotalEl.textContent = t;
    }

    // ✅ Animated button/number pop helper
    function pop(el){
      if (!el) return;
      el.classList.remove("pop");
      void el.offsetWidth; // reflow
      el.classList.add("pop");
    }

    // Delegate item actions
    document.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const itemEl = e.target.closest(".item");
      const action = btn.getAttribute("data-action");
      if (!action) return;
      if (!itemEl) return;

      const idx = Number(itemEl.getAttribute("data-index"));
      const cart = getCart();
      if (!cart[idx]) return;

      const qnumEl = itemEl.querySelector(".qnum");

      if (action === "inc"){
        cart[idx].qty = Number(cart[idx].qty || 1) + 1;
        setCart(cart);
        render();
        // animate
        pop(btn);
        pop(qnumEl);
      }

      if (action === "dec"){
        const next = Number(cart[idx].qty || 1) - 1;
        if (next <= 0){
          cart.splice(idx, 1);
        } else {
          cart[idx].qty = next;
        }
        setCart(cart);
        render();
        pop(btn);
        pop(qnumEl);
      }

      if (action === "remove"){
        cart.splice(idx, 1);
        setCart(cart);
        render();
      }
    });

    // Clear cart
    function clearCart(){
      localStorage.removeItem(CART_KEY);
      render();
    }
    clearBtn?.addEventListener("click", clearCart);
    drawerClearBtn?.addEventListener("click", () => { clearCart(); closeDrawer(); });

    /**************************************************************
     * ✅ Checkout actions
     * - Stripe Phase 1: Payment Link redirect (fast, static friendly)
     * - Otherwise: Email Order (admin formatted) via mailto:
     **************************************************************/
    function buildAdminEmail(cart){
      const orderId = makeOrderId();
      const ts = localTimestamp();
      const subtotal = calcSubtotal(cart);

      // Item lines
      const lines = cart.map((item) => {
        const name = item.product || "Item";
        const size = item.size && item.size !== "—" ? item.size : "N/A";
        const qty = Number(item.qty || 1);
        const price = money(item.price || 0);
        return `• ${name} | Size: ${size} | Qty: ${qty} | Unit: ${price}`;
      }).join("\n");

      // Subject + body
      const subject = `${SUBJECT_PREFIX}${orderId} — ${countCart(cart)} item(s)`;

      const body =
`Hello Unashamed Strength Team,

NEW ORDER REQUEST
Order ID: ${orderId}
Timestamp: ${ts}

ITEMS
${lines}

TOTALS
Subtotal: ${money(subtotal)}
Shipping: TBD
Tax: TBD
Total: ${money(subtotal)}

CUSTOMER INFO (fill in)
Name:
Phone:
Email:
Shipping Address:
City/State/Zip:

Notes:
`;

      return { subject, body };
    }

    function doCheckout(){
      const cart = getCart();
      if (!cart.length) return;

      // ✅ Stripe Phase 1 (Payment Link)
      if (STRIPE_PAYMENT_LINK && STRIPE_PAYMENT_LINK.startsWith("http")){
        window.location.href = STRIPE_PAYMENT_LINK;
        return;
      }

      // ✅ Email admin fallback
      const { subject, body } = buildAdminEmail(cart);
      const mailto =
        `mailto:${encodeURIComponent(ORDER_EMAIL)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      window.location.href = mailto;
    }

    checkoutBtn?.addEventListener("click", doCheckout);
    drawerCheckoutBtn?.addEventListener("click", () => { doCheckout(); });
    mobileCheckoutBtn?.addEventListener("click", () => { doCheckout(); });

    // Sync badge if multiple tabs
    window.addEventListener("storage", (e) => {
      if (e.key === CART_KEY) render();
    });

    /**************************************************************
     * ✅ Mobile drawer controls
     **************************************************************/
    function openDrawer(){ document.body.classList.add("drawer-open"); }
    function closeDrawer(){ document.body.classList.remove("drawer-open"); }

    openDrawerBtn?.addEventListener("click", openDrawer);
    drawerCloseBtn?.addEventListener("click", closeDrawer);
    drawerOverlay?.addEventListener("click", closeDrawer);
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeDrawer();
    });

    // Initial render
    render();
  </script>
</body>
</html>
